import{P as D}from"./PageList-4b526691.js";import{_ as P,o as n,c as a,b as t,t as m,i as c,v as u,h,F as b,f as M,u as k,e as y,l as V,m as $,M as I,r as g,d as _,g as E,q as S,s as A}from"./index-6c1bda23.js";import{e as T,g as B,o as v,f as N}from"./apiPath-bdbb9eb3.js";const F={name:"ProductEditor",data(){return{tempProduct:{}}},props:["isCreatingProduct","product","tempImg","setProduct","productModal","uploadModal"],methods:{setTempImg(o){this.$emit("update:tempImg",o)},addImg(){Array.isArray(this.tempProduct.imagesUrl)||(this.tempProduct.imagesUrl=[]),this.tempProduct.imagesUrl.unshift(this.tempImg),this.$emit("update:tempImg","")},removeImg(){const o=this.tempProduct.imagesUrl.indexOf(this.tempImg);o!=-1&&this.tempProduct.imagesUrl.splice(o,1)},openUpload(){this.productModal.hide(),this.uploadModal.show()}},computed:{haveSameImg(){var o;return(o=this.tempProduct.imagesUrl)==null?void 0:o.includes(this.tempImg)},nowTempImg:{get(){return this.tempImg},set(o){this.$emit("update:tempImg",o)}}},watch:{product(o){this.tempProduct=o}}},O={id:"productModal",ref:"productModal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},j={class:"modal-dialog modal-xl"},q={class:"modal-content border-0"},J={class:"modal-header bg-dark text-white"},R={id:"productModalLabel",class:"modal-title"},z=["textContent"],G=t("span",null,"產品",-1),H=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),K={class:"modal-body"},Q={class:"row"},W={class:"col-sm-4"},X={class:"mb-2"},Y={class:"mb-1"},Z=t("label",{for:"imageUrl",class:"form-label"}," 輸入圖片網址 ",-1),tt=["src"],et={key:0,class:"mb-1"},ot=t("div",{class:"form-label"},"商品圖片",-1),st=["onClick","src","alt"],dt={class:"col-sm-8"},lt={class:"mb-3"},it=t("label",{for:"title",class:"form-label"},"標題",-1),nt={class:"row"},at={class:"mb-3 col-md-6"},rt=t("label",{for:"category",class:"form-label"},"分類",-1),ct={class:"mb-3 col-md-6"},ut=t("label",{for:"price",class:"form-label"},"單位",-1),mt={class:"row"},pt={class:"mb-3 col-md-6"},ht=t("label",{for:"origin_price",class:"form-label"},"原價",-1),gt={class:"mb-3 col-md-6"},_t=t("label",{for:"price",class:"form-label"},"售價",-1),bt=t("hr",null,null,-1),Pt={class:"mb-3"},ft=t("label",{for:"description",class:"form-label"},"產品描述",-1),It={class:"mb-3"},vt=t("label",{for:"content",class:"form-label"},"說明內容",-1),yt={class:"mb-3"},wt={class:"form-check"},kt=t("label",{class:"form-check-label",for:"recommend"},"店家推薦",-1),Mt={class:"mb-3"},Ut={class:"form-check"},xt=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Ct={class:"modal-footer"},Lt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Dt(o,e,l,p,d,i){return n(),a("div",O,[t("div",j,[t("div",q,[t("div",J,[t("h5",R,[t("span",{textContent:m(l.isCreatingProduct?"新增":"編輯")},null,8,z),G]),H]),t("div",K,[t("div",Q,[t("div",W,[t("div",X,[t("div",Y,[Z,c(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>i.nowTempImg=s),class:"form-control",placeholder:"請輸入圖片連結"},null,512),[[u,i.nowTempImg]])]),l.tempImg.length>0?(n(),a("img",{key:0,class:"img-fluid",src:l.tempImg,alt:"temp image"},null,8,tt)):h("",!0)]),l.tempImg.length>0?(n(),a("div",et,[i.haveSameImg?(n(),a("button",{key:1,class:"btn btn-outline-danger btn-sm d-block w-100",type:"button",onClick:e[2]||(e[2]=(...s)=>i.removeImg&&i.removeImg(...s))}," 刪除圖片 ")):(n(),a("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100",type:"button",onClick:e[1]||(e[1]=(...s)=>i.addImg&&i.addImg(...s))}," 新增圖片 "))])):h("",!0),t("div",null,[t("button",{class:"btn btn-outline-info btn-sm d-block w-100",type:"button",onClick:e[3]||(e[3]=(...s)=>i.openUpload&&i.openUpload(...s))}," 上傳圖片 ")]),Array.isArray(d.tempProduct.imagesUrl)?(n(),a(b,{key:1},[ot,(n(!0),a(b,null,M(d.tempProduct.imagesUrl,(s,f)=>(n(),a("img",{key:s,onClick:w=>i.setTempImg(s),class:"img-fluid",src:s,alt:"product image "+f},null,8,st))),128))],64)):h("",!0)]),t("div",dt,[t("div",lt,[it,c(t("input",{id:"title","onUpdate:modelValue":e[4]||(e[4]=s=>d.tempProduct.title=s),type:"text",class:"form-control",placeholder:"請輸入標題"},null,512),[[u,d.tempProduct.title]])]),t("div",nt,[t("div",at,[rt,c(t("input",{id:"category","onUpdate:modelValue":e[5]||(e[5]=s=>d.tempProduct.category=s),type:"text",class:"form-control",placeholder:"請輸入分類"},null,512),[[u,d.tempProduct.category]])]),t("div",ct,[ut,c(t("input",{id:"unit","onUpdate:modelValue":e[6]||(e[6]=s=>d.tempProduct.unit=s),type:"text",class:"form-control",placeholder:"請輸入單位"},null,512),[[u,d.tempProduct.unit]])])]),t("div",mt,[t("div",pt,[ht,c(t("input",{id:"origin_price","onUpdate:modelValue":e[7]||(e[7]=s=>d.tempProduct.origin_price=s),type:"number",min:"0",class:"form-control",placeholder:"請輸入原價"},null,512),[[u,d.tempProduct.origin_price]])]),t("div",gt,[_t,c(t("input",{id:"price","onUpdate:modelValue":e[8]||(e[8]=s=>d.tempProduct.price=s),type:"number",min:"0",class:"form-control",placeholder:"請輸入售價"},null,512),[[u,d.tempProduct.price]])])]),bt,t("div",Pt,[ft,c(t("textarea",{id:"description","onUpdate:modelValue":e[9]||(e[9]=s=>d.tempProduct.description=s),type:"text",class:"form-control",placeholder:"請輸入產品描述"},`
                `,512),[[u,d.tempProduct.description]])]),t("div",It,[vt,c(t("textarea",{id:"content","onUpdate:modelValue":e[10]||(e[10]=s=>d.tempProduct.content=s),type:"text",class:"form-control",placeholder:"請輸入說明內容"},`
                `,512),[[u,d.tempProduct.content]])]),t("div",yt,[t("div",wt,[c(t("input",{id:"recommend","onUpdate:modelValue":e[11]||(e[11]=s=>d.tempProduct.recommend=s),class:"form-check-input",type:"checkbox"},null,512),[[k,d.tempProduct.recommend]]),kt])]),t("div",Mt,[t("div",Ut,[c(t("input",{id:"is_enabled","onUpdate:modelValue":e[12]||(e[12]=s=>d.tempProduct.is_enabled=s),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[k,d.tempProduct.is_enabled]]),xt])])])])]),t("div",Ct,[Lt,t("button",{type:"button",class:"btn btn-primary",onClick:e[13]||(e[13]=(...s)=>l.setProduct&&l.setProduct(...s))}," 確認 ")])])])],512)}const Vt=P(F,[["render",Dt]]),$t={name:"DeleteProduct",props:["wantDeleteProduct","deleteProduct"]},Et={id:"delProductModal",ref:"delProductModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},St={class:"modal-dialog"},At={class:"modal-content border-0"},Tt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Bt={class:"modal-body"},Nt={class:"text-danger"},Ft={class:"modal-footer"},Ot=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function jt(o,e,l,p,d,i){return n(),a("div",Et,[t("div",St,[t("div",At,[Tt,t("div",Bt,[y(" 是否刪除 "),t("strong",Nt,m(l.wantDeleteProduct.title),1),y(" 商品(刪除後將無法恢復)。 ")]),t("div",Ft,[Ot,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=(...s)=>l.deleteProduct&&l.deleteProduct(...s))}," 確認刪除 ")])])])],512)}const qt=P($t,[["render",jt]]),Jt={name:"UploadImage",props:["checkImg","uploadImg","tempUploadImg"]},Rt={id:"uploadModal",ref:"uploadModal",class:"modal fade",tabindex:"-1","aria-labelledby":"uploadModalLabel","aria-hidden":"true"},zt={class:"modal-dialog"},Gt={class:"modal-content border-0"},Ht=t("div",{class:"modal-header bg-info text-white"},[t("h5",{id:"uploadModalLabel",class:"modal-title"},[t("span",null,"上傳圖片")]),t("button",{type:"button",class:"btn-close","aria-label":"Close","data-bs-dismiss":"modal"})],-1),Kt={class:"modal-body"},Qt={key:0},Wt=["src"],Xt={class:"modal-footer"},Yt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Zt(o,e,l,p,d,i){return n(),a("div",Rt,[t("div",zt,[t("div",Gt,[Ht,t("div",Kt,[l.tempUploadImg.length>0?(n(),a("div",Qt,[t("img",{id:"preview",class:"img-fluid",src:l.tempUploadImg},null,8,Wt)])):h("",!0),t("form",{enctype:"multipart/form-data",method:"post",onSubmit:e[1]||(e[1]=V((...s)=>l.uploadImg&&l.uploadImg(...s),["prevent"]))},[t("input",{onChange:e[0]||(e[0]=(...s)=>l.checkImg&&l.checkImg(...s)),type:"file",name:"file-to-upload",accept:"image/jpg, image/jpeg, image/png"},null,32)],32)]),t("div",Xt,[Yt,t("button",{type:"button",class:"btn btn-primary",onClick:e[2]||(e[2]=(...s)=>l.uploadImg&&l.uploadImg(...s))}," 確認上傳 ")])])])],512)}const te=P(Jt,[["render",Zt]]);const ee={components:{PageList:D,ProductEditor:Vt,DeleteProduct:qt,UploadImage:te},data(){return{pagination:{},products:[],tempProduct:{},tempImg:"",tempUploadImg:"",isCreatingProduct:!0,wantDeleteProduct:{},productModal:{},delProductModal:{},uploadModal:{}}},props:["nowPage"],methods:{...$(E,["setLoading","setIsLogin"]),checkAuth(){const o=document.cookie.replace(/(?:(?:^|.*;\s*)token\s*=\s*([^;]*).*$)|^.*$/,"$1");o.length!=0?(this.$http.defaults.headers.common.Authorization=o,this.setLoading(1),this.$http.post(T).then(e=>{e.data.success?(this.setIsLogin(!0),this.getProducts()):(alert("尚未登入"),this.$router.push("/admin/login"))}).catch(e=>{alert(e.response.data.message),this.$router.push("/admin/login")}).then(()=>{this.setLoading(-1)})):(alert("尚未登入"),this.$router.push("/admin/login"))},isPositiveInteger(o){return!(o==null||o===""||!/^[0-9]+$/.test(o)||parseInt(o)<=0)},getProducts(){if(!this.isPositiveInteger(this.nowPage))return this.$router.push("/admin/products/1"),!1;this.setLoading(1),this.$http.get(B,{params:{page:this.nowPage}}).then(o=>{this.products=o.data.products,this.pagination=o.data.pagination,this.pagination.total_pages<parseInt(this.nowPage)&&this.$router.push(`/admin/products/${this.pagination.total_pages}`)}).catch(o=>{alert(o.response.data.message)}).then(()=>{this.setLoading(-1)})},showCreateProduct(){this.isCreatingProduct=!0,this.productModal.show(),JSON.stringify(this.tempProduct)!="{}"&&this.tempProduct.id===void 0||(this.tempProduct={},this.tempImg="")},showEditProduct(o){this.isCreatingProduct=!1,this.productModal.show(),this.tempImg="",this.tempProduct=JSON.parse(JSON.stringify(o))},setProduct(){this.tempProduct.imageUrl=this.tempProduct.imagesUrl[0],this.tempProduct.id===void 0?this.createdProduct():this.editProduct()},createdProduct(){this.setLoading(1);const o=v;this.$http.post(o,{data:this.tempProduct}).then(()=>{alert(`新增 ${this.tempProduct.title} 成功`),this.tempProduct={},this.getProducts(),this.productModal.hide()}).catch(e=>{alert(e.response.data.message)}).then(()=>{this.setLoading(-1)})},editProduct(){this.setLoading(1);const o=`${v}/${this.tempProduct.id}`;this.$http.put(o,{data:this.tempProduct}).then(()=>{alert(`修改 ${this.tempProduct.title} 成功`),this.getProducts(),this.productModal.hide()}).catch(e=>{alert(e.response.data.message)}).then(()=>{this.setLoading(-1)})},setDeleteProduct(o){this.wantDeleteProduct=o,this.delProductModal.show()},deleteProduct(){this.setLoading(1);const o=`${v}/${this.wantDeleteProduct.id}`;this.$http.delete(o).then(()=>{alert(`刪除 ${this.wantDeleteProduct.title} 成功`),this.getProducts(),this.delProductModal.hide()}).catch(e=>{alert(e.response.data.message)}).then(()=>{this.setLoading(-1)})},returnEdit(){this.productModal.show(),document.querySelector("[name=file-to-upload]").value=""},checkImg(o){const e=o.target.files[0];if(e){const l=new FileReader;l.onload=p=>{this.tempUploadImg=p.target.result},l.readAsDataURL(e)}},uploadImg(){this.setLoading(1);const o=document.querySelector("[name=file-to-upload]").files[0],e=new FormData;e.append("file-to-upload",o),this.$http.post(N,e).then(l=>{l.data.success?(alert("上傳成功"),this.tempImg=l.data.imageUrl,this.tempProduct.imagesUrl.unshift(this.tempImg),this.uploadModal.hide()):alert(l.data.message)}).catch(l=>{alert(l.response.data.message)}).then(()=>{this.setLoading(-1)})}},watch:{nowPage(o){o&&this.getProducts()}},mounted(){this.checkAuth(),this.productModal=new I(document.getElementById("productModal")),this.delProductModal=new I(document.getElementById("delProductModal")),this.uploadModal=new I(document.getElementById("uploadModal")),document.getElementById("uploadModal").addEventListener("hidden.bs.modal",()=>{this.tempUploadImg="",this.returnEdit()})}},U=o=>(S("data-v-550fcbd2"),o=o(),A(),o),oe={class:"container"},se={class:"mt-4 d-flex justify-content-between align-items-end"},de=U(()=>t("span",null,"⭐為店家推薦",-1)),le={class:"table mt-4"},ie=U(()=>t("thead",null,[t("tr",null,[t("th",{width:"120"},"分類"),t("th",null,"產品名稱"),t("th",{width:"120"},"原價"),t("th",{width:"120"},"售價"),t("th",{width:"100"},"是否啟用"),t("th",{width:"120"},"編輯")])],-1)),ne={key:0},ae={class:"text-end"},re={class:"text-end"},ce=["textContent"],ue={class:"btn-group"},me=["onClick"],pe=["onClick"];function he(o,e,l,p,d,i){const s=g("PageList"),f=g("ProductEditor"),w=g("DeleteProduct"),x=g("UploadImage");return n(),a(b,null,[t("div",oe,[t("div",se,[de,t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(...r)=>i.showCreateProduct&&i.showCreateProduct(...r))}," 建立新的產品 ")]),t("table",le,[ie,t("tbody",null,[(n(!0),a(b,null,M(d.products,(r,C)=>(n(),a("tr",{key:C},[t("td",null,m(r.category),1),t("td",null,[r.recommend?(n(),a("span",ne,"⭐")):h("",!0),y(" "+m(r.title),1)]),t("td",ae,m(r.origin_price),1),t("td",re,m(r.price),1),t("td",null,[t("span",{class:"text-success",textContent:m(r.is_enabled?"啟用":"未啟用")},null,8,ce)]),t("td",null,[t("div",ue,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:L=>i.showEditProduct(r)}," 編輯 ",8,me),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:L=>i.setDeleteProduct(r)}," 刪除 ",8,pe)])])]))),128))])]),_(s,{pagination:d.pagination,nowPage:l.nowPage,nowView:"/admin/products"},null,8,["pagination","nowPage"])]),_(f,{"isCreating-product":d.isCreatingProduct,product:d.tempProduct,setProduct:i.setProduct,tempImg:d.tempImg,"onUpdate:tempImg":e[1]||(e[1]=r=>d.tempImg=r),productModal:d.productModal,uploadModal:d.uploadModal},null,8,["isCreating-product","product","setProduct","tempImg","productModal","uploadModal"]),_(w,{wantDeleteProduct:d.wantDeleteProduct,deleteProduct:i.deleteProduct},null,8,["wantDeleteProduct","deleteProduct"]),_(x,{uploadImg:i.uploadImg,"temp-uploadImg":d.tempUploadImg,checkImg:i.checkImg},null,8,["uploadImg","temp-uploadImg","checkImg"])],64)}const Pe=P(ee,[["render",he],["__scopeId","data-v-550fcbd2"]]);export{Pe as default};
