import{_ as k,m as L,r as g,o as r,c as d,b as e,h as u,F as C,f as U,t as c,d as n,w as q,g as w,e as b,i as x,v as V,j as f}from"./index-071cb391.js";import{a as v,c as F,d as O}from"./apiPath-bdbb9eb3.js";const E={name:"CartView",data(){return{cart:{},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{...L(w,["setLoading"]),getCart(){this.setLoading(1),this.$http.get(v).then(l=>{this.cart=l.data.data}).catch(l=>{alert(l.response.data.message)}).then(()=>{this.setLoading(-1)})},updateCart(l){this.setLoading(1);const t={product_id:l.product_id,qty:l.qty};this.$http.put(`${v}/${l.id}`,{data:t}).then(h=>{alert(h.data.message),this.setLoading(-1),this.getCart()}).catch(h=>{alert(h.response.data.message),this.setLoading(-1)})},deleteAllCarts(){this.setLoading(1),this.$http.delete(F).then(l=>{alert(l.data.message),this.getCart()}).catch(l=>{alert(l.response.data.message),this.setLoading(-1)})},removeCartItem(l){this.setLoading(1),this.$http.delete(`${v}/${l}`).then(t=>{alert(t.data.message),this.setLoading(-1),this.getCart()}).catch(t=>{alert(t.response.data.message)}).then(()=>{this.setLoading(-1)})},createOrder(){const l=this.form;if(this.cart.carts.length<1)return alert("購物車為空，請加入商品"),!1;this.setLoading(1),this.$http.post(O,{data:l}).then(t=>{alert(t.data.message),this.$refs.form.resetForm(),this.form.message="",this.getCart()}).catch(t=>{alert(t.response.data.message)}).then(()=>{this.setLoading(-1)})}},mounted(){this.getCart()}},A={class:"text-end"},N={class:"table align-middle"},S=e("thead",null,[e("tr",null,[e("th"),e("th",null,"品名"),e("th",{style:{width:"150px"}},"數量/單位"),e("th",null,"單價"),e("th",null,"總價")])],-1),B=["onClick"],M=e("i",{class:"fas fa-spinner fa-pulse"},null,-1),j={key:0,class:"text-success"},D={class:"input-group input-group-sm"},I={class:"input-group mb-3"},T=["onUpdate:modelValue","onChange"],z={class:"input-group-text",id:"basic-addon2"},G={class:"text-end"},H={class:"text-end"},J={key:0,class:"text-success"},K=e("td",{colspan:"4",class:"text-end"},"總計",-1),P={class:"text-end"},Q={key:0},R=e("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),W={class:"text-end text-success"},X={class:"my-5 row justify-content-center"},Y={class:"mb-3"},Z=e("label",{for:"email",class:"form-label"},"Email",-1),$={class:"mb-3"},ee=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),te={class:"mb-3"},se=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ae={class:"mb-3"},le=e("label",{for:"address",class:"form-label"},"收件人地址",-1),oe={class:"mb-3"},ne=e("label",{for:"message",class:"form-label"},"留言",-1),re={class:"text-end"},de=["disabled"];function ie(l,t,h,ce,s,m){const _=g("VField"),p=g("ErrorMessage"),y=g("VForm");return r(),d(C,null,[e("div",A,[s.cart.total?(r(),d("button",{key:0,class:"btn btn-outline-danger",type:"button",onClick:t[0]||(t[0]=(...a)=>m.deleteAllCarts&&m.deleteAllCarts(...a))}," 清空購物車 ")):u("",!0)]),e("table",N,[S,e("tbody",null,[s.cart.carts?(r(!0),d(C,{key:0},U(s.cart.carts,a=>(r(),d("tr",{key:a.id},[e("td",null,[e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:i=>m.removeCartItem(a.id)},[M,b(" x ")],8,B)]),e("td",null,[b(c(a.product.title)+" ",1),a.coupon?(r(),d("div",j,"已套用優惠券")):u("",!0)]),e("td",null,[e("div",D,[e("div",I,[x(e("input",{min:"1","onUpdate:modelValue":i=>a.qty=i,onChange:i=>m.updateCart(a),type:"number",class:"form-control"},null,40,T),[[V,a.qty,void 0,{number:!0}]]),e("span",z,c(a.product.unit),1)])])]),e("td",G,c(a.product.price),1),e("td",H,[s.cart.final_total!==s.cart.total?(r(),d("small",J,"折扣價：")):u("",!0),b(" "+c(a.final_total),1)])]))),128)):u("",!0)]),e("tfoot",null,[e("tr",null,[K,e("td",P,c(s.cart.total),1)]),s.cart.final_total!==s.cart.total?(r(),d("tr",Q,[R,e("td",W,c(s.cart.final_total),1)])):u("",!0)])]),e("div",X,[n(y,{ref:"form",class:"col-md-6",onSubmit:m.createOrder},{default:q(({errors:a,meta:i})=>[e("div",Y,[Z,n(_,{modelValue:s.form.user.email,"onUpdate:modelValue":t[1]||(t[1]=o=>s.form.user.email=o),id:"email",name:"email",type:"email",class:f(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required"},null,8,["modelValue","class"]),n(p,{name:"email",class:"invalid-feedback"})]),e("div",$,[ee,n(_,{modelValue:s.form.user.name,"onUpdate:modelValue":t[2]||(t[2]=o=>s.form.user.name=o),id:"name",name:"姓名",type:"text",class:f(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required"},null,8,["modelValue","class"]),n(p,{name:"姓名",class:"invalid-feedback"})]),e("div",te,[se,n(_,{modelValue:s.form.user.tel,"onUpdate:modelValue":t[3]||(t[3]=o=>s.form.user.tel=o),id:"tel",name:"電話",type:"tel",class:f(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:"required|min:8|max:10"},null,8,["modelValue","class"]),n(p,{name:"電話",class:"invalid-feedback"})]),e("div",ae,[le,n(_,{modelValue:s.form.user.address,"onUpdate:modelValue":t[4]||(t[4]=o=>s.form.user.address=o),id:"address",name:"地址",type:"text",class:f(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required"},null,8,["modelValue","class"]),n(p,{name:"地址",class:"invalid-feedback"})]),e("div",oe,[ne,x(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.form.message=o),id:"message",class:"form-control",cols:"30",rows:"10"},null,512),[[V,s.form.message]])]),e("div",re,[e("button",{disabled:!(s.cart.total&&i.dirty&&i.valid),type:"submit",class:"btn btn-danger"}," 送出訂單 ",8,de)])]),_:1},8,["onSubmit"])])],64)}const he=k(E,[["render",ie]]);export{he as default};
